var wppaAtachments=[];function docReady(t){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(t,1):document.addEventListener("DOMContentLoaded",t)}function loader(t,e="start"){if(document.getElementById(t))switch(e){case"start":document.getElementById(t).innerHTML+='<div class="lds-ring"><div></div><div></div><div></div><div></div></div>';break;case"stop":document.getElementById(t).querySelector(".lds-ring").remove()}}function getAttachmentDetails(t,e,a=null,n=null){let i=document.getElementById("attachmentDialog");i.querySelector("#wppa_attachmentTitle").value=e,i.querySelector("#wppa_attachmentDescription").value=e,i.querySelector("#wppa_attachmentTitleShow").innerHTML=e,i.querySelector("#wppa_attachmentFileUrl").value=t,null!=a&&i.querySelector("#wppa_attachmentSend").setAttribute("data-key",a),null!=n&&i.querySelector("#wppa_attachmentCoverImageShow").setAttribute("src",n),i.classList.add("attach-dialog-show")}function uploadAttachCover(t){loader("wppa_attachmentSend");let e=new FormData;e.append("file",t,t.name),e.append("action","wppaUploadImage");let a=new XMLHttpRequest;a.open("POST",wpApiUrl,!0),a.onload=function(){if(this.status>=200&&this.status<400){let t=this.response;null!=t&&""!=t&&(document.getElementById("wppa_attachmentCoverImageShow").setAttribute("src",t),loader("wppa_attachmentSend","stop"))}else console.log("Internal Server Error!\n"+this.response)},a.onerror=function(){console.log("Request error...")},a.send(e)}function closeAttachmentDialog(){document.getElementById("wppa_attachmentSend").removeAttribute("data-key"),document.getElementById("attachmentDialog").classList.remove("attach-dialog-show")}Dropzone.autoDiscover=!1,docReady(function(){null!=fileList&&""!=fileList&&(wppaAtachments=JSON.parse(fileList));new Dropzone("div#attachmentDropzone",{dictDefaultMessage:"Solte arquivos aqui",init:function(){this.on("success",function(t,e){getAttachmentDetails(e,t.name)})}});if(document.getElementById("attachmentDialog")){document.getElementById("attachmentDialog");document.getElementById("wppa_attachmentTitle").addEventListener("change",function(){document.getElementById("wppa_attachmentTitleShow").innerHTML=this.value});let t=document.getElementById("wppa_attachmentCoverImage");t.addEventListener("change",function(){uploadAttachCover(t.files[0])}),document.getElementById("wppa_attachmentSend").addEventListener("click",function(){let t={name:document.getElementById("wppa_attachmentTitle").value,description:document.getElementById("wppa_attachmentDescription").value,cover_image:document.getElementById("wppa_attachmentCoverImageShow").getAttribute("src"),url:document.getElementById("wppa_attachmentFileUrl").value};if(this.getAttribute("data-key")){let e=this.getAttribute("data-key");wppaAtachments[e]=t,document.getElementById("attachment_"+e).querySelector("span").innerHTML=t.name}else{wppaAtachments.push(t);let e='<li class="att-item" id="attachment_'+(wppaAtachments.length-1)+'"><span>'+t.name+'</span><div class="action-btns"><a title="Abrir" class="link-btn" href="'+t.url+'" target="blank" rel="noopener noreferrer"><i class="fas fa-link"></i></a><i title="Detalhes" data-key="'+(wppaAtachments.length-1)+'" class="fas fa-edit edit-btn"></i><i title="Remover" data-key="'+(wppaAtachments.length-1)+'" class="fas fa-times remove-btn"></i></div></li>';document.getElementById("attachmentsContainer").innerHTML+=e}document.getElementById("wppa_attachment_list").value=JSON.stringify(wppaAtachments),closeAttachmentDialog()}),document.getElementById("closeAttachmentDialog").addEventListener("click",function(){closeAttachmentDialog()})}document.addEventListener("click",function(t){for(var e=t.target;e&&e!=this;e=e.parentNode)if(e.matches(".remove-btn"))wppaAtachments.splice(e.getAttribute("data-key"),1),document.getElementById("wppa_attachment_list").value=JSON.stringify(wppaAtachments),e.parentNode.parentNode.remove(),document.getElementById("attachmentsContainer").querySelectorAll("li").forEach((t,e)=>{t.setAttribute("id","attachment_"+e),t.querySelector(".edit-btn").setAttribute("data-key",e),t.querySelector(".remove-btn").setAttribute("data-key",e)});else if(e.matches(".edit-btn")){let t=wppaAtachments[e.getAttribute("data-key")];getAttachmentDetails(t.url,t.name,e.getAttribute("data-key"),t.cover_image)}})});